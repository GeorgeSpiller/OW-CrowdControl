import "CustomGameSettings.json";   // OSTW lib outdated: "Limit Roles":"1 Tank 2 Offense 2 Support" is a valid config
import "Effects.ostw";
import "HUDController.ostw";


void WaitForHeroSelection(Player p)
{
    Boolean b = true;
    while (b)
    {
        if (HasSpawned(p) && HeroOf(p)!=null && p.IsAlive())
        {
            SetStatus(p,null,Status:Status.Invincible);
            SetStatus(p,null,Status:Status.PhasedOut);
            SetInvisible(p);
            // these done seem to work? strange
            DisallowButton(p,Button.PrimaryFire);
            DisallowButton(p,Button.SecondaryFire);
            DisallowButton(p,Button.Ability1);
            DisallowButton(p,Button.Ability2);
            DisallowButton(p,Button.Ultimate);
            // SetMoveSpeed(p,500);
            // SetGravity(p,50);
            // SetJumpVerticalSpeed(p,150);
            b = false;
        }
        Wait(0.250);
    }
}

 rule: "Player Controller"
 Event.OngoingPlayer
 Player.Slot5
 {
    Player p = EventPlayer();
    // Player[] notme = RemoveFromArray(AllPlayers(), p);
    WaitForHeroSelection(p);
    
    // the async! means that the subroutine is called asyncronously, and that if its already executing it will do nothing.
    while (true)
    {
        if (p.IsButtonHeld(Button.Crouch) && p.IsButtonHeld(Button.PrimaryFire))
        {
            async! DoubleSpeed(); 
        } else if (p.IsButtonHeld(Button.Crouch) && p.IsButtonHeld(Button.SecondaryFire)) 
        {
            async! LowGravity(); 
        } else if (p.IsButtonHeld(Button.Crouch) && p.IsButtonHeld(Button.Ability1)) 
        {
            async! GiveUltimate(); 
        }
        Wait(0.250);
    }
 }

